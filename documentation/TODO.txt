Test at http://localhost:81/alttp/public/

Known Bugs:
    - Enemies can get trapped inside the Staff Tower graphics if they are in the are it occupies when it is created.
        - Should probably kill enemies in this area when setting up the tower.

    - Teleporting while grabbing a pot with astral projection can make you face south but still be grabbing the pot
        - Probably stop grabbing with projection when teleporting.
    - Enemies hit in the spirit world make noise when taking damage
        - this might be nice to keep for the cocoon boss
        - when players can actively hit enemies in the spirit world we should play a sound. For example, hitting an enemy with a linked bush shouldn't be silent.
    - Clone tool bugs
        - Mana regen is wrong when using clone tools (seems to multiply consumption/regen by number of clones)
    - Held rocks/bushes are invisible while using cloak
    - Piercing projectiles that can push things should be stopped by the first object they push
        or not be able to push additional objects, for example, the charged chakram.
    - Pushing on a solid object sitting on thorny ground shouldn't hurt you:
        -return tileBehaviors and objectBehaviors separately, only damage if tile is solid+damaging.
    - Cliff Edge issues:
        - Would be nice if staff could go across edges.
        - Chakram / Bow can hit tiles below ledges sometimes
            - When chakram is returning over a ledge.
                - We can avoid this by not placing bushes directly next to ledges that the player can get on top of.
        - Sometimes bow/chakram get stopped when firing down cliff edges
            - This is because these tiles are not marked low.
            - Marking these tiles as low would allow shooting up them as they don't have actual cliff ledges
            - Marking these tiles as cliff ledges will probably allow jumping down them in some cases which will need to be fixed.
    - Shadow renders behind door tops when jumping down ledges.
    - Spirit Barrier appears above door frames when moving East/West through doors.
        - This only applies with old tile sets, so probably isn't worth fixing.

Graphics:
    Add slam effects for the staff.
    Sweat animation when pulling on something you cannot move.
    Add Item Get Frame gfx/wukongimportantitem.png 20x28
    Add sparkles to peach loot + hud.
    Add damage effects for hitting enemies?
    Add damage effect for player hurt? (alttp doesn't have anything like this)

Cannot reproduce:
    - Robot stopped moving in ST basement. Maybe ice damage against shield is broken?
        - Unable to reproduce.
    - There was a bug where almost killing Storm Heart with burning damage would leave it invulnerable, but I haven't been able to reproduce.
        - If this happens again, investigate the state of the Storm Heart to get a better understanding of what triggers this, for example is it related to enrage or enemy iframes?
    - If controlled clones despawns during quick clone toss, sometimes you'll take control of the original clone in an invalid position, such as inside a solid object or cliff face.
        - Possibly fixed by other changes.

Current tasks:
    - Fix clones continue to drain spirit energy when switching to a new area instance.
        - Despawn clones that aren't in the hero's current area.
    - For some reason picking up/throwing a clone seems to reset spirit energy cooldown.

    - Add a variant cave with new paths to the mountains + spirit world.
        - 3 possible entrances determined by variant seed:
            - Overworld near Mountain Tower
            - West most area of Waterfall Village
            - Inside of Bush Cave
        - Contains a spirit world portal behind Clone Tool (cracked wall) or staff (rocks surrounded by pits)
        - Contains a 50 Jade check with no logic requirements
        - Peach Piece behind either medium range switch or cloak switches
        - One time difficult enemy encounter on the path to the exit/spirit world:
            - Golem hand + 2 charging beetles
            - Ent + 2 arrow turrets
            - Triple elements + Plants
        - Exit blocked by Cloud Boots/Ice(U-turn cracked ground) or Astral Projection (pot switches in both worlds)
            - Exits to ledge above entrance to cave ascent, which will now have a Silver Ore on it.

    - Add a short grace period where whirlpools cannot grab you when surfacing in an area.
        - Not sure if we have an existing timer for determining this, but we could add the time the hero entered the area if necessary.


    - Add Spike Boots that replace leather boots. Spike boots never slip and have 10% increased movement speed.
        - Have to find schematics + 1 silver ore and can craft at regular smith after fully upgrading chakram.
        - Similar upgrades from spirit smith for iron boots+cloud boots after fully upgrading gold chakram.

    - Add additional blockedPath styles.
        - Maybe cracked pots requiring clone tool

    - Populate Spirit Ruins
        - Link entrances to the spirit world
        - Add placeholder NPCs and dialogue
            - Use 2x scale elements for NPCs
        - Add NPC with a check to the East building
        - Add a visible check somewhere outside that can be peaked early with spirit sight

    - Add consumable items
        - Peach Potion - Restores 5 hearts
        - Spirit Tonic - Restores all Spirit Energy (and resets cooldown)
        - Spirit Elixer - Restores all Spirit Energy and grants unlimited Spirit Energy for 5s

    - Allow copying and pasting variants
    - Allow resizing variants by clicking and dragging near the edges.
        - Should probably change the arrow cursor for this.

    - Bad looking tiles when turning off middle beads stream in waterfall tower.
        - The bead cover covers up the beads on the ground. In some sense it should be rendered on a particular tile layer.
        - We can fix this by setting a layer id on the bead cover for the layer it is covering (floor2), then when it is not fully open,
        render all background layers above that layer on top of it as part of the object. This would allow us to draw certain objects
        "beneath" tiles in general at the expense of some extra renders.

    - Moving platform gets stuck in a weird position sometimes in the forge.
        - When transitioning, reset the moving platforms if they are not in the same area as the player.

    - Staff should block ground spike attacks.
        - Keep the ground animation, but prevent it from increasing ground height and stop the actual spike from appearing.

    - Clones disappear when draining lava/etc.
        - Grown thorns disappear when draining lava.
    - Tower staff animation freezes when used to hit switches for draining lava.
    - Change mother speech bubble in randomizer when you can finish and when you have full cleared the game?
    - Shouldn't be able to use level 2 charge with level 1 weapon.
    - Elemental immunities are confusing, they just pass through enemies.
        - For arrows specifically, maybe they can still deal normal damage.
    - Fire/Ice arrows bounce of void hands when they are up in the air.
    - Should we prevent throwing rocks up ledges?
    - summoner ruins ledge walls let you fire arrows up them because they aren't actually ledges
        - Add ledges to these in addition to the solidMap that they have.

    - Pulling animation changes when pressing a direction while the game is paused
        - Game inputs should not be read while rendering.
            - If this is needed, they need to be recorded elsewhere to the state to where they are not updated when paused.

    Swimming bugs:
        - Chakram/bow fire when armed and you unequip iron boots
            - Instead let's just disarm them.
        - Chakram returns to below you if you attack and then unequip iron boots
            - Let's have chakram move towards the hero's z value when returning and not disappear until it is within N px vertically.
            - Make sure chakram respects z index when rendering.

    - Make sure destroying connected tiles is consistent: cutting/smashing does not effect the other world, pushing/throwing should

    - Add graphical interface for choosing Nimbus Cloud location using map.
        - How to signify cancel operation?


    - Ice mines are not cleaned up when defeating Guardian in Cocoon.
        - Same for long lasting lightning attacks

    - Add Bell graphics when provided by Jon.

    - Fix push/pull interactions with ledges.
        - Minor issues:
            - Pot can render in front of you when standing on ledge above it.
                - Not sure if this is fixable as it seems to require a real z value to correct.
                - We should probably just avoid allowing objects to be next to vertical ledges to prevent this.
            - Moving sideways can be blocked in a passage that is exactly 32px wide even though ideally everything would wiggle into place.
                - This is pretty uncommon but can still happen even with code to move the player towards objects on grab.
                - The issue is that if the player's subpixel doesn't match the pot, when the pot can no longer move forward, the player is stuck at
                  the subpixel distance. The attempt to wiggle, but the pot has no wiggle room(it is flush with the wall), so the player's movement is aborted.

    - Fix doors closed as you walk into them.
        - Good example is walking into the key room NW from the big chest in tomb.
        - I think we update doors once on creating the area, let's go ahead and detect if the hero is walking into a door then
            - render the door open if the hero + 16 *dx/dy intersected the door object.
        - Play door open/closed sounds FX when it changes whether it is open based on the player being over it.

    - Fix audio restarts when going under water during the frost beast fight.

    - peach cave narrative
        - Add a message to the chakram chest if you check it after opening it.
        - Add dialogue after defeating the beetle boss
            *A voice echoes through the cave*
            {|}Thank you for saving me.
            [-]

    - Minor issue with ledges
        - Should be able to grab ledges when below them just like you can grab solid tiles.

    - Guardian boss improvement
        - Have the boss appear staggered in the material world when hit by the balls and despawn the astral projection, similar to the rival fight.

    - Add ladder to exterior of staff tower that becomes visible once the elevator is repaired.

    - Save statues missing dialog:
        - jade city
        - spirit forest
        - gauntlet
        - war palace
        - lab
        - spirit sky
        - holy sanctum
        - sky palace
        - forge

    - Helix Rival improvements
        - Add level 2 ice attack that he uses only after being frozen once:
            - "Think you can reflect this?"
            - Shoots an ice spike object at the player which comes to rest near the edge of the battlefield
            - After this ice attace, move to center then shoots 3 large fire balls one after another at the player that knock the rival back on cast.
                - If the player positions themselves correctly they can knock the rival back into the ice spike and stagger/freeze the rival.
                - Either way the ice spike disappears after the fire ball attack to prevent accumulation.


    - Get drain graphics for forge?

    - Allow sneaking into grand temple with invisibility
        - Replace door with open arch guarded by a warrior monk
        - Ultimately this should be a narration box that causes the guard to say Vanara cannot enter the temple.
        - Make sure rolling doesn't let you pass

    - Add a task for a generic enemy transformation animation I can use for upgrading enemies to elemental versions.
        - Having them instantly change looks buggy in some cases, and for the flies it is hard to tell when it even happened.

    - Fade out any text cues during screen transitions. Right now it just abruptly disappears.


    - Leon respawned at a door and kept going up/down the entrance stairs to the lightning sanctum.
        - I could not reproduce however and couldn't see anything suspicious in the code.

    - Overworld project
        - Add lake
            - Should have two waterfalls/rivers entering from the northwest+northeast on opposite sides of a divide
            - The lake temple should be near the northwest on what would have been the banks of the river going to the summoner ruins before the crater wascreated
                - The lake temple should be near the edge of the crater so that it is plausible that it wasn't completely destroyed when the crater was made.
                - The direction of the creater is west southwest with most of the rim of the crater built up on the south and west.
                    - The northern rim is mostly the natural elevation of the mountains it ran into
                    - The lake drains to the east towards the holy city on what was previously a fairly small water shed, but is now much larger due to diverting water from the west water shed.
            - Add cliffs around parts of the lake.
                - Maybe we can reduce the exits out of the lake to make pathing more interesting and to help push the player towards the waterfall initially.
            - Add cliffs underwater in the lake that bottom out at the location of the helix

    - Extract air stream effect so it can be used as an enemy ability
        - Add a warmup time that can be used as a tell (ramps up from 0-100% effect over N ms).

    - Add chunk objects to editor
        - Choose w/h, style, then any additional properties from the style parameters.
        - Have an excavatedBuilding style we can use in summoner ruins
            - parameters doorId and spiritDoorId for optional entrance that can be added to it.
            - Using ids of existing doors will allow us to freely configure the doors.
        - This is a bit tricky to implement because we want the chunk to modify tiles/object properties (like doors) but
            we don't want it to change the definition, otherwise changes from the chunk will get saved in the base map
            but we want those applied on load.
            Because of this, we probably just want the chunk to apply to the area instance after it is created but this means
            that to display the correct state, chunks will have to constantly be reapplied during editing.
            Perhaps this can work like minimap generation where chunks autorefresh by default, but

    - Allow editing tiles in adjacent areas.

    - Fix: Do not allow dying due to burn when boss is defeated
        - Set hero life to at least 1 and remove any burns on boss completion.

    - Forest temple dialogue:

        Head Native Scientist:
        - Greetings 817H, we have been looking forward to testing you.
        - You have questions, yes? Complete these simple tests and we may have answers.
        - More tests means more answers, yes? But don't worry if you can't complete them all.
        - You can always come back later to try again.
        - This was the only test 817V failed to complete.

        Native Scientists:
        - We have to monitor the nutrition of the Vanara very closely.
            - Vanara with too much or too little nurishment have to be returned to stasis.
            - ...{|}Maybe you should talk withe one of the Vanara scientists instead.
        - Vanara upset the balance of the Spirit World. Humans and Vanara are both unpredictable, but Vanara can touch the Spirit World with too much ease.

        Vanaran Scientists:
        - Our Vanaran ecosystem is invasive. {|} Without proper management it will overrun these lands.
            - Vanaran life has evolved to take root in alien worlds and make life habitable for us,{|} but we are supposed to avoid living worlds.
            - We were supposed to leave when we detected life here, but there was an accident and our ship crashed.

    - Add automatic door cue messages when possible:
        - Use expicit floor cues if defined.
        - Only do if a Map Label is defined.
        - Show a map cue any time the floor changes when entering a new area section.

    Charging Beetle Hybrids
        Storm - Instead of a normal charge, show a red ray warning and then do a lightning warp up to 96px that hurts everything in between.
        Flame - Leave flames behind while charging and create a fire blast on impact with radius 48 and no tell.
        Frost - Freeze ground while charging (can charge across water). Ice blast on death.

    - Add puzzle to forest temple where you need to move element from one enemy to another to solve.
        - Defeate Ice snake to let ice element possess plant, then have the plant freeze cracked ground or a pot.

    - Brainstorm ideas for Forest Temple
        - Include as much generated content as possible
            - Generated content should use a new worldSeed that is readable from url parameters
                - worldSeed should be 0 by default
                - For randomizer, worldSeed should default to randomizer seed
        - NPCs should be Vanara Crew Biologists and Native Spirit Scientists
            - Might have to think about how specifically Vanara share information+techniques with native Spirit Gods to avoid giving them too much power/information.
            - Probably an underlying tension where as factions they are strategically trying to gain more information, but at the same time many individuals
                just want to learn more and solve important problems.
            - There is a faction of military scientists that previously served the War God that other native scientists distrust more than the Vanara.
                - The boss could be a side project of these scientists that the Vanara have allowed them to create specifically for training Vanara in combat.
        - Area should contain artificial biomes for hosting a variety of creatures both native material/native spirit and vanara as well as new hybrids.
            - Will need to support hybrid monsters of various sorts
                - exist fully in both worlds
                - have different parts in each world
                - phase in and out between worlds
                - symbiotic pairs between spirit beings and material beings
                    - flame spirit pairs with a snake to give it fire powers and allow it to survive in colder environments
                - Set of native elemental spirits for each element, lightning/fire/ice
                    - Could have more powerful spirits make more powerful hybrids.
                    - This also sets a good precedence for spirits bonding with the MC after defeating the elemental beasts.
                    - Summoning the elemental beasts would require sacrificing animals for them to bond with.
                        - The elemental beasts power is so destructive that the animals' bodies are destroyed over the course of the summoning.
                        - The phoenix was created by progenitors but was too powerful being able to restore its physical body with energy from the spirit world.
                        - The elemental beasts with their Vanara hearts represents a similar threat as the phoenix, except the hearts function as a weakness.
                        - Level 2 charged attacks could damage the player as they are channeling too much energy from the spirit realm for their body to handle.
                            - The phoenix crown would eliminate this damage by using the crown to channel energy more effectively.
            - Water Biome, Fire Biome, Desert Biome, Cave Biome, Forest Biome, Grass Biome, Cold Biome, Marshe Biome
            - New enemies added here can be used to populate other areas of the game.
                For example the water temple and the crater need new enemies that could be shared here.
            - It would also be cool to have a history of successful hybrids with some having been out in nature for generations, and others recently released and
                others currently in testing, others still in development or planning.
            - The enemies the hero encounters are intentionally accessible and being tests for hostility and survivability.
                - MC has been expected here for some time, perhaps even before the start of the game.

    - Break up Spirit Sky to make it act like a hub for exploring the spirit world.
        - Add magic beans that can grow vines to the sky
            - Above lake to top of helix/sky palace courtyard
            - Above holy city to ???/sky city
            - Above forest to two-way teleporter above forest
        - Plant beans by having a bean and interacting with a planter (plant a bean here?)
        - Beans cost 20/50/100/200 Jade
            - Beans sold in Sky City so cannot be source of sky access
        - Need some kind of one way locks that can be opened in spirit sky after opening a new entrance
            - Activatable bridges (cloud sommersault would allow full traversal of sky, which is probably fine)
            - Could make it so that entering sky palace requires gaining access to multiple sky areas first

    - Require traversing War Palace from top to bottom in the Spirit World, starting from the Sky


    - generate bow chest switch puzzle
        - switches are E/W/N/S from a single point in the area at least 4 tiles out from the point.
        - increase difficulty with
            - 2 - 4 switches
            - prefer adding any additional locks below for required items since that will make the puzzle more unique based on context.
                - This should be a general design principal for generating puzzles.
            - add pots in front of switches
                - add rocks/walls to the sides of pots
            - add pits around switches+pots to prevent manually pushing/pulling the pots.
            - offset row/cols of switches
            - switches are not all on screen at once.
        - additional locks:
            - any element by setting switch element
            - spirit sight by adding decoy switches and requiring sight to identify the correct switch
                - Only effective with 2+ switches
            - gloves by locking the pot with stones
            - staff by putting pits around the shooting area
                - need to be careful about only offsetting switches in one direction if this is used.

    - generate bow door switch puzzle
        - increase difficulty with
            - 1 - 4 switches on 4/3/2/1s timers


    - Chest styles
        - Trash (Jade)
        - Dungeon Item (Key/Map/Big Key)
        - Collectible (Silver/Gold Ore/Peach/Peach Piece)
        - Prize (Chakram/Tool/Victory Point)


    - Allow lookind underwater with R2 when you do not have iron boots.
        - Use same effect as spirit sight

    - Forest temple boss should provide a golden peach in addition to the clone tool.

    - Investigate updating various tile sets to new version:
        - identify changed tiles and plan how to fix issues caused by the update:
            - possibly switch the order of tiles to prevent any changes
            - identify and update maps where tiles change
        - crystal
        - stone

    - Hot room status is incorrect in alternate world, it is always matching the current world.
        - Fixing this will prevent ice tiles from forming incorrectly in hot rooms in the alternate world.
        - It will also allow us to make hot rooms consistently burn enemies.

    - Add respawn flag to objects that causes them to respawn if destroyed.


    - Use grey cloud tiles for lightning bolt cloud animation
        - Possibly also for the cloud tiles during the storm beast fight
            - At least the clouds around the storm heart
        - Would be good to change to normal clouds after the fight.

    - Make it easier to find the gloves
        - Add a quest state that highlights the entrance with the gloves.
        - Move the map to the main chamber as a new check with a simple puzzle to obtain it
            - Include the big chest room on the map, draw chests and big chests to the map

    - Block exit door in pit room in War Temple 3F

    - Aimed Projectiles for Cocoon boss an other
        - EnemyProjectile wrapper for CrystalSpike/Flame/Frost/Spark that takes an element to determine which projectile to use
            - Or it takes a projectile Effect, but there is a utility method to generate to the projectile effect from element.
        - Projectile appears stationary in the air during delay frames (this can be set as a boolean)
        - Projectile can be assigned a target, if so
            - Projectile vx/vy update to point at target as long as it is visible
            - Possibly can set an additional delay where vx/vy stop targeting before projectiles launch
        - Cocoon boss summons a ring of aimed projectiles around them with 400ms increasing delay on each one


    - Brainstorm how the beasts get released
        - Maybe destroying the idols causes them to wake up and flee the War Temple
        - War God convinces Rival to summon the beasts to the material world to distract the Spirit Gods from his plan
        - While they are "missing" they are actually being given their Vanaran Hearts

    - Forge
        - Gold mail offered by NPC if you bring gold ore and 500 money

    - Heavy 2x2 blocks that can only be pushed if the player has mitts
        - Make this a variation of push/pull object that is 32x32

    - Try using fade transition for material -> spirit world
        - If this isn't better, try using a circle wipe transition with a gradient instead.

    - Randomizer hint sometimes says you are in BK mode with checks in logic
        - I think this happens when your last check is behind a locked door that you have enough keys for but the randomizer thinks you don't because it isn't counting locked doors you have already opened.
        - We can fix this by tracking totalSmallKeys independent of current small keys and have the logic be based on the total.

    - Add vertical tiles in between sky and ground:
        - Could give a greater feeling of vertical depth to the world
        - south facing cliff face near the mountains
        - waterfall near the waterfall
        - outside of staff tower when it is setup in the tile
        - empty sky/abyss tiles when falling through random sky tiles.

    - Flame wall improvement
        - Refactor as individual flames so that each flame can hit individually or be destroyed by ice.


    - Support multiple active missions
        - On map, highlight the first mission and display a location name
        - If the user confirms, show them the help text for the mission.

    - Idea to fix small hit immunity from preventing larger damage:
        - When setting iframes, record the damage that caused it.
        - When something takes a hit and has iframes, if the damage is greater than the previous iframe hit,
            take damage equal to the difference, extend iframes, and record the greater damage amount.

    - Upgrade entrance randomizer to support complex connected exit graphs.
        - Currently it only supports connected exits that can be traveled in all directions.

    - Improve projectile interactions
        - Set stopX/Y when stopping a projectile which will prevent them from appearing to into cliffs/walls that they hit.
            - if stopX > hitbox.x and direction is left, adjust x by the difference, similarly for other directions.
        - Creating a projectile while standing over a ledge won't register it is high because it never hits the ledge.
            - Maybe add a function that runs hits for 8px before the projectiles starting position that we run when it is
            created to set isHigh, then clear passedLedgeTiles in case that was set to avoid accidentally throwing up ledges.
        - Right now ledges block attacks anywhere in the tile rather than just when they are on the ledge, additionally only true values apply instead of both true+false values.
            - You can observe this by standing halfway off a cliff then turning away from the cliff and attacking with chakram/bow

    - Projectiles should be able to shoot down over solid ledges, but not up them
        - Make solid ledges actually ledges but prevent jumping over them
        - Might have to implement this as a one way ledge to prevent the down ledge from causing the player to ignore walls.
            - Does not allow jumping down
            - Blocks moving into as if going up a ledge
            - Could implement with solidLedges+solidDiagonalLedge

    - Add underwater mechanics
        - allow swimming over low/medium barriers (set floorHeight to 16px on these)
        - Swarms of fish that are composed of fish shaped particles that chase the player
            - Hitting them destroys a couple of particles and slows the fish down but does not destroy them
        - large turtle monster
            - spawns up to 2-3 small swimming turtles that chase and attack you with 3-4 hp a piece
            - does a 2s spinning aoe bubble attack (like void frost) on 6s cooldown
        - simple medium fish monster that just wander around like snakes.
        - medium sword fish that moves back and forth and speeds up if you are lined up with it

    - Add additional uses for true sight
        - Rolling ball puzzles that can be solved by moving an invisible pot
        - Invisible cracked doorway to a new cave in spirit world.
            - To prevent memorizing this in randomizer, we could randomly place the door in four different places that are inconvient to check
                - For example, they might require you to jump down a cliff to check if the door is there.

    - Add meteor attacks that leave behind rocks to void tree fight
        - Give to tree + voidFlame
        - Use smaller versions for enrage mode when voidFlame is active
        - Reduce number of rocks in the golem fight and add this attack to it

    - Spawn up to 2 Lightning Drones in void tree fight

    - Add punching fist attack to void tree rage phase if voidStone is active

    - Restrict laser barrage to if voidStone is active. Change it to be single bursts of 4 that can occur multiple times per phase. Slightly increase delay.

    - Add void pit tiles and use them in the void area, add solid cliff edges to prevent jumping into the void.
        - This will allow the astral projection to move freely over the void.

    - Holy Sanctum Improvements
        - Add phoenix boss before phoenix crown prize
            - The phoenix spawns by opening the large chest with the crown inside of it and drops the crown when defeated.
            - When opening the chest, the crown prize appears.
                "You obtained the Phoenix Crown?!" "..." "The Crown bursts into flames!!"
                Then the crown sprite turns into the Phoenix and the battle commences
                The Phoenix regenerates life faster the more wounded it is. It can only be defeated with a level 2 charge attack when weakened enough.
                ? Should this same sequence play out with any item in randomizer, or should the Phoenix crown always initiate the fight in randomizer
                    - Perhaps spawning the Phoenix briefly transports the player to a pocket spirit dimension where the fight happens.
                    - For now, let's just have this apply to whichever item is placed in the Phoenix Crown chest in the Holy Sanctum.
                    - The item will still appear to be the phoenix crown on opening the chest, butt then the Phoenix will just drop whatever it was assigned.
        - Add sanctum tower with bow in big chest
            - Include hybrid material/spirt world puzzles

    - Mysteries
        - Lava appears under floor 2 in the middle of void tree fight
        - Certain tiles can be frozen in lava on voidFlame

    Cocoon Boss
        - Improve visuals for persistent blast attacks

    - Add crucible to the end of the Grand Temple

    - Add 'only' visibility option to layers that hides everything else when selected.

    - Add doors and interiors to summoner ruin buildins in spirit world
        - Populate with War God Alcolytes and the Progenitor Spirit

    - Add some additional requirement for completing crater to put the boss out of logic with few items.
        - Switches that can only be hit with staff or clone throw + iron boots

    - test staff interactions with ledges.

    - Stretch goal: allow changing lightning AOE attacks to use a ray instead of a circle if the player is too close to a conductive object.

    - Prevent grabbing tiles/objects across ledges
        - on grab, check if the player can move into the object by running the movement algorithm with a special mode that ignores all normal collisions and prevents crossing ledges in any direction. Prevent the grab if this movement check fails.

    - Cloud jumping near the edges can sometimes result in landing poorly either taking damage or underground in a ledge. Would be nice to find a way to clean up jumping from ledge to ledge.

    - Balloon Megapede Improvements
        - Tail leaves behind time AoE bombs

    - Allow destroying light stones when landing with iron boots?

    - Drain all lava in the crater when the fire beast isn't spawned yet? (only matters for entrance randomizer)

    - Allow walking on clouds/cracked ground while invisible?
        - Would have to be careful in sky not to run out of spirit energy
        - Might be difficult to tell if checks are in logic based on mana bar
            - Could add special logic check against specific max spirit amounts to simplify this.

    - Mine cart mechanic with switchable tracks.
        - Or maybe a pipe puzzle with lava flow in the forge. Maybe NPC asks for help fixing the pipes.

    - Dungeon with super tile that is just the vertical face of a cliff/tower/tree that you can climb up/jump down to change floors.

    - Add some speaker name so it is clear who is talking in cut scenes with multiple characters.
        - Add this to cut scene with Elder+Rival

    - Update logic to account for clone throw over obstacles?
        - Wait on this until we have adjusted any obstacles we don't want to allow this for.

    Puzzle ideas
        - Use a clone to stand on a switch to hold a door open.
        - Use a clone to jump off a cliff to press one switch, then destroy it and make another clone to jump down another cliff to press another switch to open a door at the top of the cliff.
        - A linked pot needs to be dragged to cover a switch in the other world, but there are pits only in the other world that you must use spirit sight/trueSight to see.

    Change prep animation for explosion
        charge particles form randomly in a circle around the hero shooting into them,
        with shorter radius and more density as time passes.

    Gold Armor Upgrade
        If Spirit Chakram is fully upgraded and the player has golden mail they can use:
        500 Jade + 2 gold and 5 silver to double effectiveness of golden mail

    Editor Improvements
        - Track which zones have been changes since the last time they were exported
            - Show indicator that zone has "unexported" changes.
        - Save changes to zones to local storage and prompt to apply them when starting the editor.
        - Support undo/redo actions
            - Include in context menu when editor is active
        - Add graphical palettes
            - (low priority) super tile layout selection

    - Add SFX when the MC is damaged

    - Add sleeping Vanara to the Cocoon.
        - Can use a special NPC that doesn't face you when talking for now.
        - Use a variety of colors.

    World Tree
        Tower is a series of 2x2 super tiles with a vine for climbing to the next section that
        Floor 1 is land level + underwater(in material world)
            - Fight frost beast and destroy heart before advancing.
        Floor 2 is sky level + has unlockable exit to sky (in material world only)
            - Fight storm beast and destroy heart before advancing.
        Floor 3 is atmosphere level + is hot
            - Fight flame beast and destroy heart before advancing.
        Floor 4 is lower orbit + material zones have low gravity
            - Fight all elemental beasts together without hearts
        Floor 5 has final boss
        - Giant tree grows just to the north of the war temple and into the sky, occupying unused spaces in the SE corner of the map.
        - Climb giant vines in the tree to reach the top
        - Lower level parts may have parts where you go out and branches so you can see how high up you are getting
        - Tree is a clone of the helix, but allowed to grow to completion this time.

    World Tree Boss Void Beast
        - Possible 3 phase approach
            - Void tree, Outer shell, defeat to open up a pit to reach the heart
                - Takes place on most of a super tile
                - Has four sub targets that can be destroyed to temporarily disable some of its attacks/defenses
                    - Possibly starts with 2 and spawns 3 during second phase and all 4 for final phase.
                    - Which ones spawned are random, but deterministic for each seed.
                    - Targets are neutral, fire, ice, lightning, and enable different defense/offense mechanics.
                - Lots of large attacks to dodge while you navigate the arena
                    - (neutral) golem hands, Laser beams
                    - Fire walls, lava ground
                    - Lightning strikes, lightning barriers
                    - Frost grenades, ice walls
            - Void heart, defeat to relase the final boss
            - Void beast
                - maybe looks like a carnivorous plant with a giant mouth full of teeth and a bunch of tendrils like scorpion tails.
                    - Could use this boss design for the forest temple if not here.

        - Fight takes place on most of a full super tile, but each section of the fight is on a smaller platform in the material world where the player damages the boss and avoids various attack mechanics.
            - Maybe the battlefield is even taller than a regular super tile and the player must keep advancing tiers sort of like the final battle with the statues in ff6.
            - Each tier could focus on a different pair of combat mechanics like staff + iron boots, and each travel section could focus on different movement mechanics
        - After a certain amount of time/damage, the boss phases and requires the player reach another platform to damage it, which becomes more difficult as the phases progress, eventually requiring the player to use portals to the spirit realm to cross platforms provided by NPC helpers to reach the next platform.
        - Elemental weak spots that must each be hit to briefly expose the main weak spot.
            - Start with a single spot + 1 element, and advance to up to 5 across all 3 elements.
            - Can arrange them differently to benefit different tools.
        - Aided by Champion initially and then Vanara Rival during the last phase.

        Must rescue Champion and work together to defeat the boss
            - Mechanics where one of you creates an opening for the other to damage the boss.
            - Mechanics where you protect each other from boss attacks.
            - Failure to protect champion will:
                - Require completing a rescue mechanic or waiting long enough for her to free herself
                - Cannot benefit from champion mechanics for damage or protection while champion is out of comission
        Phases where specific elements are required to damage it.
        Phases designed for each tool, but does not require them
            - Tools can give extra opportunities to damage the boss
                - Barrier to reflect projectiles/protect champion while they attack.
                    - Maybe a mechanic where you put up a barrier and reflect attacks while she prepares a strong attack against the boss
                - Bow to shoot distant weak spots
            - Tools can make it easier to avoid attacks

    Lab + World Tree Notes:
        - Requires all elements to complete
        - Fight rival near the start to claim the last element
        - Possible flow:
            Enter throne room of the War Temple in the Spirit World and fight rival, get last element and open tunnel entrance.
                - This step is only completable after fighting the rival during the 3rd spirit beast battle.
            Tunnel takes you to the lab where the War God's Scientists have been creating Hybrdid creatures and have made a modified World Tree Seed from the Helix.
            Can(must?) find clone upgrade to complete the lab.
            The seed is activated(possibly by combined proximity of champion+MC) and grows a giant tree that MC must climb to rescue the Champion and stop the War God.
            The War God will use the engine to make a breeding ground for his drone soldiers, the MC might use it to synthesize the Vanara and Native life to coexist.

    - Flying enemies should not move over abyss tiles(make abyss tiles + ceiling tiles impassable to flying enemies).

    Peach Cave improvements
        - Fix spirit world tiles
        - Add Spirit World Checks
            - Add a 2 way portal to boss chamber
            - Add a single cracked entrance to the top from the overworld.
                - This is to allow easy discover from the spirit world but prevent using this cave for spirit world access early.
            - Add 4 easy checks to top floor and bombable pit entrance to basement
                - Add cracked status to pit entrances.
            - Require Mitts for entering/exiting from the basement.
            - Add 3 checks behind different tool combinations
                - cracked ground for cloud boots/ice magic/invisibility
                - staff or teleportation to get across L shaped pits
                - bow+torches or fire element to unfreeze a chest

    - Add behavior that prevents non-flying enemies from crossing tiles/objects, use for cracked ground, escalators, bead cascades, etc.
        - Anything that doesn't handle enemies gracefully either needs to keep enemies out or add handling.

    Storm Beast
        - Storm Beast Heart should summon lightning summoning minions each time you remove 10% of its health.
        - Storm Beast Heart should take 80% reduced damage after losing 25% health until the cloud reforms.
        - Storm Beast Heart should have no enraged behavior or invulnerability for the cloud.
        - There should be a mechanic for ending Storm Beast's enrage phase early.
            - For example, it summons 2 + N lightning turrets and the enrage phase ends when they are defeated.
            - It would be cool if using cloud boots to walk on the clouds around the tower was beneficial for this or some other mechanic.
        - Storm Beast can turn into lightning and teleport as a beam sending shockwaves out at both ends.
        - Storm Beast can charge south to exit the battle field

    - Game occasionally plays small bits of music while muted.

    - Make sure ice tiles are removed from frost beast+heat sink battles after they are defeated.

    - Add new hold+walk chakram animations
        - play last 2 frames of attack animation on release.

    - Work on new waterfall graphics
        - Email Jon about waterfall graphic updates.


Combat Ideas:
    - Concentric damaging rings that collapse into the player. Player must time it so that they are close enough together to dodge roll through in order to avoid damage.
    - Rolling enemy that leaves a trail of ice/fire behind it and bounces off walls. Hitting it knocks it in different directions.

Minigame Ideas:
    - Add Vanara VR dream world with mini games.
        - Boss practice
    - Could add something like an AR arcade to spirit city


Staff Improvements:
    - Charging staff 2 should show a preview of where it will hit and get wider in addition to longer
        - This should start at 4x1, 5x1 then 6x2->10x2, 11x3->15x3, 16x4->20x4
        - Preview will only show the max size that will fit in the current space
        - Ideally you could move around while charging and the preview will update appropriately
        - Would be nice to have this preview behavior when holding down the staff button for staff 1.

Throwing an object into a pit should use the pit animation rather than breaking.

Respawn improvements:
    Only adjust respawn when in the same screen area as the spawn point.
    Or possibly only adjust respawn when using specific doors.
        Map dungeon entrances to respawn points?

Tutorial Improvements:
    Add advanced combat/tool tutorials
        - Maybe NPCs in home cave, or some kind of training/tutorial dojo?
        - Hitting enemies with chakram held in hand
        - Default Charged chakram attack
        - Enemy iframes prevent them from damaging you
        - Maybe different sections for different tools.
        - Reflecting projectiles

Add more screen shakes:
    - Lava draining transition
    - Probably for some impactful boss attacks.
    - Maybe when falling from a large height.
    - Scene where elemental beasts escape and attack the holy city
        - Maybe could be periodic large shake+explosion as if there is a large explosion nearby
        - Could have different combination of effects to signify attacks from each type of elemental beast
        - Could make sure these effects are also used when actually fighting the beasts for consistency

Improve Staff Tower Setup:
    - Maybe should create a staff tower object and use this instead of the current layer solution
    - Then we can detect if you are facing the object and not standing inside it to deploy the tower.
    - Would force the tower to look consistent and make it easy to update when we have better graphics
    - Can also detect zone overworld vs sky to create the upper+lower parts correctly.
    - Can render consistent ground graphics for when the tower is not present.
    - Animation should be throwing staff into the sky as it grows with its shadow, then falls to the ground when the shadow is as large as the foundation.

High level list of things left to do:
    Areas missing significant content:
        Lab
        World Tree
    Missing Bosses for existing areas:
        Forge Boss
        Phoenix boss in Holy Sanctum
        Eight Trigram Furnace at the end of the Gauntlet
        Crater midboss
        Helix Boss
            - Instead of fighting this boss, you will see it, but then abort because of the beasts attacking the city
            - Then you will actually fight this boss at the end of the Grand Temple or Jade Palace or possibly as a mid boss on the Warship.
    Missing mechanics:
        - Vanara dreamland boss simulator with difficulty modifiers
        Hero helping during first elemental beast fight
            Hero wears monk fighting attire
            Creates a spirit barrier during rage phase that MC can hide in to prevent all damage
            Attacks or distracts the beats while fighting the heart
            Adds dialog cues for guiding the MC to destroy the heart
            Heals MC or restores MC spirit energy periodically
        Rival during last elemental beast fight
        Spirit Gates + Spirit Keys
            - Probably do beanstalks instead of this.
        Spirit shop + Jade Idols
        Treasure Hunter Shop
        Fertility shrine donations
    Items missing implementation:
        Gloves charge 1 + 2

Generic boss improvements
    - Add vulnerable phases for bosses where they take ~5x damage, increase boss health by ~2x

Lava improvements:
    - Eventually we might want to make this temporary.

Misc improvements
    - allow facing diagonals while not moving?

Add toasts to development for undoing actions:
    - Deleting layers
    - Replacing > 100 tiles


Simple randomization ideas:
    - Allow floor switches under covered tiles, randomizer the location of a floor switch to open a door.
        - Make sure true sight reveals this.
    - Place a key under a random pot
        - Make sure spirit sight reveals this.

Treasure Hunter Store
    - Initially can only carry 200 coins
    - Treasure hunter sells
        - Full life for  20 coins
        - 500 coin wallet for 50 coins
        - 1000 coin wallet for 200 coins
    - The first time you find money in a chest that would exceed wallet size you find a coupon from the treasure hunter for the value of the chest advertising his store.
    - Future chests that would exceed your wallet size contain treasures that you can sell to the treasure hunter for the value of the coins from the chest.
    - Every 5 chests containing money unlock new items in the treasure hunter store
        - Peach Piece for 100 coins
        - 1000 coin wallet for 200 coins
        - Jade Idol for 300 coins
        - Lodestone necklace (50% damage from lightning attacks) for 500 coins

Fertility Shrine
    - Donate 50 coins at a time in the material world
    - Chests will appear in the spirit world based on the total amount donated
        50 -> Jade Idol
        100 -> Peach Piece
        200 -> Spirit Key (cannot donate more than 200 coins)

Spirit Store(s)
    - Items might be split between different vendors
    - Trade Jade Idols for items
        2 -> Peach Piece
        3 -> Spirit Key
        5 -> Quick Charge (40% reduction in time to charge)

Charge Chakram Attack:
    - Maybe change level 1 charge to spin around hero in a circle twice? Brief 0.5s invulnerability with attack animation.
    - Charge level 2 could have 2 chakrams spin at different radiuses and directions? 50 mana, lasts 4 seconds.

At some point I should write tests to validate certain things like:
    - All zone+object targets are defined.
    - All bombable + locked doors have ids, all objects with saveStatus set have ids.
    - All objectFlags correspond to some object or dialogue key or loot type
    - All escaped dialogue corresponds to a special frame or loot type.

Clone improvements
    Add particle effects when using the clone tool (+animation eventually)

Additional Bow Behavior:
    Arrows should have stuck frames for diagonals or stick out orthoganal to whatever they hit.
    Charge level 2 creates an elemental explosion
        - Neutral element can destroy objects similar to clone explosion.

Peach Cave Improvements:
    - Add enemies:
        - Eggs that hatch into enemies if not destroyed first
    - Sticky Web Ground
    - Add boss:
        - Spawns eggs
        - Drains light and regains a bit of health for every 25% lost

Golem Boss Improvements:
    - Tighten up timing when switching between attacks
        - Cut short any hand actions that aren't close to completion when starting enrage modes.
    - Slam both hands together
    - Quickly slam both hands in succession a single time.
    - Knocking bolders down from the ceiling (use rock riles + rock particles when they break)
        - Could drop some down for certian fist slam attacks
        - Could have the boss slam against the walls when strafing side to side or raise entire body and slam ground to drop stones.
        - Could also drop additional permanent barries that reduce the safe zones on the sides.

Dungeon 2 Improvements:
    - Add more uses of spirit sight:
        - See actual elemental beasts in the front room where the statues are located.

Dungeon 3 Improvements:
    - Add new enemies.
    - Animate the ents when they attack.

River Temple Improvements:
    - Some underwater enemies
    - Some crab enemies with ice shells that require fire element to defeat
    - Allow swimming over low walls, use ice spikes to block paths if necessary.
    - Maybe torches should stay lit during the boss fight once turned on.
    - Add special behavior for frozen doors instead of having two door objects.


Staff Tower Improvements
    - Add a prompt after defeating the boss to indicate that the elevator is working again
        - Might be tricky to word in a way that makes sense. "The lights got brighter, maybe some of the machines work now."
    - Add content to 4F Material world, probably some sort of gauntlet that is easier when the boss is defeated.
        - Should have a short cut so it can by bypassed after completing once.
    - Conveyer belts/escalators.
        - Conveyer belts should also effect movable object/enemies on the ground touching them.
        - Lightning magic will turn a conveyer belt on if it is off.
    - Disabled conveyer belt with pots on it that needs to be turned on to move the pots out of the way.


Crater Improvements
    - Add additional lava animations.
    - Add platforms floating on lava.
    - Add peg switches that require hitting with the staff to activate, replace all regular switches with these.
    - Add Flame Guardian enemies
        - Stationary like Crystal Guardian
        - Replace ents with Flame Guardians
    - Lava Fireballs that spawn from lava in an anulus around player about ever 4 seconds
        - Rise into the air then explode into 8 fireballs.
    - Add Shepard's Maw enemy
        - Like a carnivorous plant in the spirit world
        - Projects fake enemies on tendrils into the material world to herd prey to its mouth
            - Fake enemies attack with projectiles or hot gas
        - Bites into the material world when the prey is near
        - Kill by evading the maw attack and then hitting it while it is briefly in material world
            - Or fight it in the spirit world if you are there
    - Add heat sink enemies
        - Like ghosts in material world
        - Become solid+vulnerable when they try to pump heat from the material world
        - Can turn lava tiles solid briefly, or solid tiles to ice
        - Will try to chase and freeze the player if they get near
            - Will lose interest in the player while frozen
        - 1 or 2 second cool down on freezing anything
    - Add Engorge Heat Sink mini boss
        - Giant heat sink that is cooling one of the under lava caves you uncover
        - 4x as large and slow, but shrinks and speeds up as damaged
        - About 2x faster than normal heats sinks at minimum size
        - On defeat it possesses the player giving them the "Cooling Spirit" ability (Fire Blessing).
        - The cave becomes hot again after the boss is defeated but they player is now immune to the effect.

War Lab
    - Praying Mantis-like bug soldiers
        - Can emerge from tubes when security beams are triggered in certain rooms.
        - Defensive stance with crossed arms that blocks most attacks
        - Leap strike attack in any direction
        - Possible dodge + Leap strike instead of blocking attack (like electric squirrel dodge)
        - Spinning Scythe projectile attack

Multi-area Boss ideas:
    - Plant-like boss that is growing in several chambers that you have to move between to defeat.
    - Boss that escapes and must be chased to different chambers.

Add Small Loot to editor that creates LootDrop
    - locked to tile grid
    - if on destructable tile (cuttable, pickup), not rendered/updated until the tile is destroyed.
        - This should actually be done for any loot, this will make it easy to hide keys under objects.
        - We can support progress items under tiles, but probably shouldn't actually use this in practice in order to avoid players searching under every tile. On the other hand, if we clearly telegraph when this happens, maybe we can void this problem and encourage players to use smart ways to check for things (like spirit sight to search under many objects for a key).
    - Default save status to dungeon
    - Add an editor option to clear the history of picked up small loots.


Add ability to charge carried objects
    Hold the passive button when picking up an object to charge
    Charge level is limited both by level of gloves/bracers and charge level.
    Should add selected element to thrown object
    Apply element changes to tiles while you hold them (bush might burn up into ash in your hands with fire element, or turn to ice)


Improve Tool Selection:
    - Color around the selection + HUD indicator should match the color of the controller button (blue + yellow for X-Box)
    - Display a letter attached to the selection based on the button/keyboard key.

Additional Staff Behavior:
    Charging the staff does a very large spin attack that knocks enemies away.
        Lvl 2 charge is a screen wide attack the applies damage+element to all enemies.
    Top N pixels of character should be drawn on foreground as well so that it appears in front of staff when facing north.
        - Probably should disable staff when character is standing on any tiles marked with low ceiling just in case.

Animate hearts refilling

Add spirit element that replaces the default 'none' element when the upgrade is found. In vanilla this would require getting all other elements first.

Idea:
    Objects you can bounce off of when jumping
        - Just make them solid and knock the player back a bit if the player's y velocity is >= some value?

