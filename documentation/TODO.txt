Test at http://localhost:81/alttp/public/

Bugs:
    Pushing on a solid object sitting on thorny ground shouldn't hurt you:
        -return tileBehaviors and objectBehaviors separately, only damage if tile is solid+damaging.
    Fix menu selection breaks sometimes
        No luck reproducing, maybe the analog stick was doing something weird?
    Doors don't appear open when moving into them from a different section
        I think this is because the door doesn't update until it is in the current areaInstance

Graphics:
    Add sparkles to peach loot + hud.


Add title screen:
    - Present 3 rows for 3 save states:
        New Game (Warn that this will erase saved data, just use a confirm prompt for now)
            Quick Demo
                - Small area.
                - Start with 6 hearts + weapon
                - Has a hub with a chest outside an entrance containing a tool. Entrance takes you to a series of puzzles that ultimately rewards you with 4 peach pieces and drops you off in the basement with the charge tool and upgrades locked behind each tool.
            Full Game
    - "Delete Save" option at the bottom
        - Select file
            - "Delete your progress?" + display file details (LEFT/RIGHT)"Yes"/"No", select "No" by default.
    - Change defeat screen to be 'Continue' + 'Quit', quit takes you back to title.

Prologue Dungeon: Peach Cave
    - Peach cave entrance is near the river in between the waterfall and the crater lake.
    - Entrance is dark, MC falls into pit 2 stories deep and lands in a pool and has to swim to shallow ground.
    - Area is dark but lit up by glowing mushrooms in some places.
    - Peach of Immortality is found early and gives initial mana bar. Needs to be found before the cat eyes+weapon.
    - Add warning text on entering dark areas without cat eyes.
        "It's too dark to see anything in here, I should turn back."
        After:
        "Now I can see where I'm going in here."
    - Add text boxes
        - Space/shift/enter to advance/dismiss
        - On start
        - "You're no ordinary monkey, what brings you here?"
            "I heard there was a golden peach hidden in this cave that could make you immortal."
        - On pickup item
    - NPC that gives weapon?
    - Exit via a pit that falls into a pool that lets out into the lake. Just use a cave entrance/exit for now,eventually I think it would be better if you swim out. Hoping the forced swimming makes it obvious you don't need an item to swim.
    - Removed dodge roll, it is a little tricky to work with and don't want it to be one of the first things a player has to learn to use.

Dungeon 1: Vanara Temple
    - Find dodge roll technique, required to complete.
    - Vanara spirit tests you and teaches spirit sight. Maybe mentions the Vanara aren't supposed to be developing their spirit abilities but is obligated to train anyone who proves themselves. Maybe rival has already been there:
        - Rival is leaving as you enter or
        - Rival meets you as you are leaving and challenges you to a duel to test your abilities.

Add ability to charge weapon
    Spin chakram around quickly in a circle twice (can move after throwing)
    Costs 10 mana

    Charge level 2 requires level 2 charge ability + level 2 weapon
    Costs 50 mana
    Similar to level 1 but 2 chakrams spin around you at different radiuses for 4 seconds.

Apply element to charge abilities.
    Costs an additional 10 mana for the element
    Add elemental crystal objects that are faded red/blue/yellow and become vibrant when hit by element

Add Small Loot to editor that creates LootDrop
    - locked to tile grid
    - if on destructable tile (cuttable, pickup), not rendered/updated until the tile is destroyed.
        - This should actually be done for any loot, this will make it easy to hide keys under objects.
        - We can support progress items under tiles, but probably shouldn't actually use this in practice in order to avoid players searching under every tile. On the other hand, if we clearly telegraph when this happens, maybe we can void this problem and encourage players to use smart ways to check for things (like spirit sight to search under many objects for a key).
    - keep a hash of picked up objects in dungeons so these only replenish on leaving the dungeon.
    - Add an editor option to clear the history of picked up small loots.


Add ability to charge tools.

Add ability to charge carried objects
    Hold the passive button when picking up an object to charge
    Charge level is limited both by level of gloves/bracers and charge level.
    Should add selected element to thrown object


Add astral projection + telekinesis abilities
    - if astral projection is available, you can move around (need to press passive tool on body to return or press something else to return instantly?)
    -
    - if telekinesis you can pick up real objects if they have stable spirit elements (possibly limited by telekinesis level)


Add upstairs/downstairs:
    Same definition as door, but different graphics + animation
        - targets are opposite stair types.
        - log error if stairs without target are found
            - Maybe log error if stairs don't connect to either a different zone or the correct floor in current zone
        - Link back to themselves if no target is defined.


Improve Tool Selection:
    - Track most recent input to control keyboard vs controller type
    - Color around the selection + HUD indicator should match the color of the controller button (blue + yellow for X-Box)
    - Display a letter attached to the selection based on the button/keyboard key.

Additional Clone Tool Behavior:
    Can pick up + throw clone, clone can pick up and throw the hero.
        -> Trying to move while held by the clone
    Holding the clone tool down allows controlling all clones at once.
    Holding the passive button (as if to meditate) will detonate the current clone for AOE elemental damage.
    Charging the clone 1 level adds elements to the clones weapon/tools/explosion.
    Charging the clone 1 level without elements makes it invulnerable for 4 seconds.

Additionl Invisibility Tool Behavior:
    Charge to deal elemental damage on contact while invisible.
    Can move through activatable crystals and some other obstacles.
        * charge invisibility then dodge roll through a line of crystals to activate them quickly.

Additional Staff Behavior:
    Should damage enemies + knock them away
    Eventually Lvl 2 staff can be used to create the Staff Tower.
    - The sides of the staff should function as a wall rather than open ground.
    Charging the staff does a very large spin attack that knocks enemies away.
        Lvl 2 charge is a screen wide attack the applies damage+element to all enemies.



Update collision detection and wiggle logic:
    - Create an array that is the width of the character(relative to movement direction) + 16
    - Assuming entry 8 = [ax, ay] and length - 9 = [ax + width - 1, ay] (for moving up or down) check pairs of 0 and 3 pixels every 4 pixels, so for w = 16, check 8+11,12+15,16+19,20+23. If any are blocked, movement is blocked, remember the blocked pixel index.
    - If movement is blocked if blocked index <= length / 2 then scan right starting at blocked index + 1. If w open pixels are found, wiggle right. If a blocked pixel is found at index >= length - w, then abort, wiggling is not possible.
    - If blocked index > length / 2, repeat the above except scanning left to check for left wiggle.

Some puzzle ideas:
    - Have a puzzle for the clone tool where a crystal deactivates after only 1s but cannot reach the door unless you stand at the door and have the clone hit the switch.
    - Similarly a puzzle where two switches must be hit within 1 second to make a chest appear. This could use the clone or an arrow.
    - A puzzle where 4 switches need to be hit in 200ms, you can blow up the clone in the middle to activate all at once.
    - If we place a block on top of a switch that toggles on release, we can make a door that requires you to push the block off of the switch.

Track the object an arrow is stuck in and move it with that target until it disappears
    - Use a different 'stuck' frame for the arrow missing the head.

Animate hearts refilling

Add spirit element that replaces the default 'none' element when the upgrade is found. In vanilla this would require getting all other elements first.


Add offering shrines in dungeons that allow players to adjust the difficulty by paying 50 money:
    - Take 1/2 damage
    - 1/2 boss life
    - easier traps (disable conveyer belts, remove spikes)
    - easier puzzles (required chests are made distinct from optional chests, positions of required items are moved to more easily accessible locations)

Include some random dungeon design in the base game:
    - Location of key under object might change (there should be some clue where it is or use spirit sight).
    - Something like peg cave, but only a single peg needs to be pressed to open it (spirit sight reveals which?).
    - Something like Eastern Palace Foyer except the correct door isn't always the center door.

Keep in mind significance of design elements for future racing/randomizer.

Add quick tool select ring on the right analog stick.

Support 64x64 super tiles for world map. Or maybe just 48x48. Probably add this after Spirit World mechanics to make sure they perform okay together.

Possible tool: Leather gloves protect you from thorn bushes.
Possible tool: Leather boots let you walk on thorny ground without taking damage.
